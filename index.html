<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Maplestory Interval Timer</title>
  <link rel="icon" href="maplestory.ico" type="image/x-icon" />
  <style>
    html, body { height: 95%; margin: 0; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #1e1e2f;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: white;
      text-align: center;
      padding: 20px;
    }
    h1 {
      background-color: rgba(0, 0, 0, 0.6);
      display: inline-block;
      padding: 10px 30px;
      border-radius: 10px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .button-group {
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      margin: 10px 5px;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      background-color: #3b82f6;
      color: white;
    }
    button:hover { background-color: #2563eb; }
    .small-button {
      padding: 7px 14px;
      font-size: 0.9rem;
      transform: scale(0.7);
    }
    .timers {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .skill {
      position: relative;
      background-color: rgba(45, 45, 68, 0.85);
      padding: 20px;
      border-radius: 12px;
      width: 260px;
    }
    .top-controls {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.8rem;
    }
    .top-controls label {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .timer-display {
      font-size: 2rem;
      margin: 10px 0;
    }
    .flashing {
      animation: flash 1s infinite alternate;
    }
    @keyframes flash {
      from { opacity: 1; }
      to { opacity: 0.5; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    #bg-selector {
      margin-left: auto;
      font-size: 0.9rem;
    }
	.top-bar {
		display: flex;
		justify-content: center;
		align-items: center;
		position: relative;
		margin-top: 30px;
		margin-bottom: 40px;
	}
	.page-title {
	  margin: 0;
	  font-size: 2rem;
	  position: absolute;
	  left: 50%;
	  transform: translateX(-50%);
	  color: white;
	  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
	}
	#bg-selector {
	  position: absolute;
	  right: 20px;
	}
  </style>
</head>
<body>
	<div class="top-bar">
	<h1 class="page-title">Maplestory Interval Timer</h1>
	 <select id="bg-selector">
		<option value="backgrounds/Lith Harbor.png">Lith Harbor</option>
		<option value="backgrounds/Maple Tree.png">Maple Tree</option>
		<option value="backgrounds/Florina Beach.png">Florina Beach</option>
		<option value="backgrounds/Chimney Trees.png">Chimney Trees</option>
		<option value="backgrounds/North Rocky Mountain.png">North Rocky Mountain</option>
		<option value="backgrounds/Nautilus Harbor.png">Nautilus Harbor</option>
		<option value="backgrounds/Cave of Life.png">Cave of Life</option>
		<option value="backgrounds/Sleepywood.png">Sleepywood</option>
		<option value="backgrounds/Cursed Temple.png">Cursed Temple</option>
		<option value="backgrounds/Deep Sea Gorge.png">Deep Sea Gorge</option>
		<option value="backgrounds/Temple of Time.png">Temple of Time</option>
		<option value="backgrounds/Path of Time.png">Path of Time</option>
		<option value="backgrounds/Ride to Orbis.png">Ride to Orbis</option>
		<option value="backgrounds/El Nath.png">El Nath</option>
		<option value="backgrounds/Ludibrium.png">Ludibrium</option>
		<option value="backgrounds/Eos Tower.png">Eos Tower</option>
		<option value="backgrounds/Leafre.png">Leafre</option>
		<option value="backgrounds/Magatia.png">Magatia</option>
		<option value="backgrounds/Nihal Desert.png">Nihal Desert</option>
		<option value="backgrounds/Peach Farm.png">Peach Farm</option>
		<option value="backgrounds/Midsummer Night's Forest.png">Midsummer Night's Forest</option>
		<option value="backgrounds/Ellin Forest.png">Ellin Forest</option>
		<option value="backgrounds/Ereve.png">Ereve</option>
		<option value="backgrounds/Edelstein.png">Edelstein</option>
		<option value="backgrounds/Vanishing Journey.png">Vanishing Journey</option>
		<option value="backgrounds/Lachelein.png">Lachelein</option>
		<option value="backgrounds/Grove of the Spirit Tree.png">Grove of the Spirit Tree</option>
		<option value="backgrounds/Heart of the Forest.png">Heart of the Forest</option>
		<option value="backgrounds/Coral Forest.png">Coral Forest</option>
		<option value="backgrounds/Living Spring.png">Living Spring</option>
		<option value="backgrounds/Sellas.png">Sellas</option>
		<option value="backgrounds/Barrier Between Worlds.png">Barrier Between Worlds</option>
		<option value="backgrounds/Royal Library.png">Royal Library</option>
		<option value="backgrounds/Happyville.png">Happyville</option>
  </select>
  </div>

	 <div class="button-group">
	  <button onclick="addSkill()">+ Add Skill Timer</button>
	  <button onclick="clearAll()">Clear All Timers</button>
	  <button onclick="startAll()">Start All Timers</button>
	  <button onclick="stopAll()">Stop All Timers</button>
	  
	  <div style="margin-top: 10px;">
		<label><input type="checkbox" id="globalMute" /> Mute All Sounds</label>
	  </div>
	</div>

  <div class="timers" id="timers"></div>

  <!-- Audio Elements -->
  <audio id="Bonk" src="sounds/Bonk.mp3" preload="auto"></audio>
  <audio id="Bubbles" src="sounds/Bubbles.mp3" preload="auto"></audio>
  <audio id="Glitter" src="sounds/Glitter.mp3" preload="auto"></audio>
  <audio id="Level Up Alarm" src="sounds/Level Up Alarm.mp3" preload="auto"></audio>
  <audio id="Level Up" src="sounds/Level Up.mp3" preload="auto"></audio>
  <audio id="Looting" src="sounds/Looting.mp3" preload="auto"></audio>
  <audio id="Pet Level Up" src="sounds/Pet Level Up.mp3" preload="auto"></audio>
  <audio id="Quest Alert" src="sounds/Quest Alert.mp3" preload="auto"></audio>
  <audio id="Quest Chime" src="sounds/Quest Chime.mp3" preload="auto"></audio>
  <audio id="Select Map" src="sounds/Select Map.mp3" preload="auto"></audio>
  <audio id="Zap" src="sounds/Zap.mp3" preload="auto"></audio>

  <script>
    const bgSelector = document.getElementById('bg-selector');
    const timersContainer = document.getElementById("timers");
    const muteToggle = document.getElementById("globalMute");
    const savedBg = localStorage.getItem('background');
    if (savedBg) document.body.style.backgroundImage = `url('${savedBg}')`;
    bgSelector.value = savedBg || "";
    bgSelector.addEventListener('change', () => {
      const url = bgSelector.value;
      document.body.style.backgroundImage = url ? `url('${url}')` : "";
      localStorage.setItem('background', url);
    });

    let skills = JSON.parse(localStorage.getItem("skills")) || [];
    let allIntervals = [];

    function saveSkills() { localStorage.setItem("skills", JSON.stringify(skills)); }

    function addSkill(data) {
      const name = data?.name || prompt("Enter skill name:");
      const cooldown = data?.cooldown || parseInt(prompt("Enter cooldown in seconds:"), 10);
      const sound = data?.sound || "Bonk";
      if (!name || isNaN(cooldown)) return;
      const skill = { name, cooldown, sound };
      skills.push(skill);
      saveSkills();
      renderSkill(skill);
    }

    function renderSkill(skill) {
      const { name } = skill;
      let cooldown = skill.cooldown;
      let sound = skill.sound;
      let flashing = false;
      let withCountdown = false;
      let timeLeft = cooldown;
      let interval = null;

      const skillDiv = document.createElement("div");
      skillDiv.className = "skill";

      const topControls = document.createElement("div");
      topControls.className = "top-controls";

      const flashSwitch = document.createElement("label");
      flashSwitch.innerHTML = '<input type="checkbox"/> Flash';
      flashSwitch.querySelector("input").onchange = e => flashing = e.target.checked;

      const muteSwitch = document.createElement("label");
      muteSwitch.innerHTML = '<input type="checkbox"/> Mute';

      const countdownSwitch = document.createElement("label");
      countdownSwitch.innerHTML = '<input type="checkbox"/> Countdown';
      countdownSwitch.querySelector("input").onchange = e => withCountdown = e.target.checked;

      topControls.appendChild(flashSwitch);
      topControls.appendChild(muteSwitch);
      topControls.appendChild(countdownSwitch);
      skillDiv.appendChild(topControls);

      const title = document.createElement("h3");
      title.textContent = name;
      skillDiv.appendChild(title);

      const timerText = document.createElement("div");
      timerText.className = "timer-display";
      timerText.textContent = cooldown + "s";
      skillDiv.appendChild(timerText);

      const countdownOverlay = document.createElement("div");
      countdownOverlay.style = `position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:bold;color:#fff;background:rgba(0,0,0,0.6);border-radius:12px;transition:opacity 0.5s ease;opacity:0;pointer-events:none;`;
      skillDiv.appendChild(countdownOverlay);

      const getSoundElement = () => document.getElementById(sound) || document.getElementById("Bonk");

      const startBtn = document.createElement("button");
      startBtn.textContent = "Start";
      startBtn.onclick = () => {
        if (interval) return;
        const startTimer = () => {
          interval = setInterval(() => {
            timeLeft--;
            if (timeLeft <= 0) {
              if (!muteToggle.checked && !muteSwitch.querySelector("input").checked) {
                getSoundElement().play();
              }
              timeLeft = cooldown;
              if (flashing) {
                skillDiv.style.transition = "background-color 0.5s";
                skillDiv.style.backgroundColor = "#4ade80";
                setTimeout(() => skillDiv.style.backgroundColor = "rgba(45,45,68,0.85)", 500);
              }
            }
            timerText.textContent = timeLeft + "s";
          }, 1000);
          allIntervals.push(interval);
        };
        if (withCountdown) {
          let count = 3;
          countdownOverlay.style.opacity = 1;
          countdownOverlay.textContent = count;
          const cd = setInterval(() => {
            count--;
            if (count <= 0) {
              clearInterval(cd);
              countdownOverlay.style.opacity = 0;
              startTimer();
            } else {
              countdownOverlay.textContent = count;
            }
          }, 1000);
        } else {
          startTimer();
        }
      };

      const stopBtn = document.createElement("button");
      stopBtn.textContent = "Stop";
      stopBtn.onclick = () => {
        clearInterval(interval);
        interval = null;
        timeLeft = cooldown;
        timerText.textContent = cooldown + "s";
      };

      const editBtn = document.createElement("button");
      editBtn.textContent = "Edit";
      editBtn.onclick = () => {
        const newCooldown = parseInt(prompt("New cooldown (seconds):", cooldown), 10);
        if (!isNaN(newCooldown)) {
          cooldown = newCooldown;
          skill.cooldown = newCooldown;
          timeLeft = newCooldown;
          timerText.textContent = timeLeft + "s";
          saveSkills();
        }
      };

      const soundDropdown = document.createElement("select");
      soundDropdown.className = "dropdown";
      ["Bonk", "Bubbles", "Glitter", "Level Up Alarm", "Level Up", "Looting", "Pet Level Up", "Quest Alert", "Quest Chime", "Select Map", "Zap"].forEach(snd => {
        const option = document.createElement("option");
        option.value = snd;
        option.textContent = snd;
        if (snd === sound) option.selected = true;
        soundDropdown.appendChild(option);
      });
      soundDropdown.onchange = e => {
        sound = e.target.value;
        skill.sound = sound;
        saveSkills();
      };

      const testBtn = document.createElement("button");
      testBtn.textContent = "Test Sound";
      testBtn.classList.add("small-button");
      testBtn.onclick = () => {
        if (!muteToggle.checked) getSoundElement().play();
      };

      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "Delete Timer";
      deleteBtn.classList.add("small-button");
      deleteBtn.style.backgroundColor = "#ef4444";
      deleteBtn.style.marginTop = "0px";
      deleteBtn.onclick = () => {
        clearInterval(interval);
        skillDiv.remove();
        skills = skills.filter(s => s !== skill);
        saveSkills();
      };

      skillDiv.append(startBtn, stopBtn, editBtn, soundDropdown, testBtn, deleteBtn);
      timersContainer.appendChild(skillDiv);
    }

    function clearAll() {
      skills = [];
      saveSkills();
      timersContainer.innerHTML = "";
    }

    function startAll() {
      document.querySelectorAll(".skill button:first-of-type").forEach(btn => btn.click());
    }

    function stopAll() {
      allIntervals.forEach(clearInterval);
      allIntervals = [];
      timersContainer.querySelectorAll(".skill .timer-display").forEach((el, i) => {
        el.textContent = skills[i].cooldown + "s";
      });
    }

    window.onload = () => {
      skills.forEach(renderSkill);
      document.querySelectorAll("audio").forEach(audio => audio.volume = 0.1);
    };
  </script>
</body>
</html>
